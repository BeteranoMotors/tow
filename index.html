<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BETERANO Tow</title>

  <!-- Estilos propios de Tow (el deploy genera style.css si existe) -->
  <link rel="stylesheet" href="./style.css" />

  <style>
    :root{ --header-offset: 86px; }
    html,body{ margin:0; padding:0; background:#0f0f0f; color:#eee; font-family:system-ui; }
    /* Reservar hueco bajo el header inyectado */
    body.header-loaded #app-host{ padding-top: var(--header-offset, 86px); }

    /* Contenedor general */
    .layout-container{ max-width: 1100px; margin: 0 auto; padding: 16px; }
    /* Franja blanca arriba (si quieres dock inline) */
    .sidebar__top{ background:#fff; border-radius:16px; padding:10px 14px; margin:12px 0 16px; }
  </style>
</head>
<body class="has-mobile-dock">
  <!-- Aquí se inyecta el header remoto -->
  <div id="bm-header-host"></div>

  <div id="app-host" class="layout-container">
    <!-- Dock inline opcional dentro de una franja blanca -->
    <div class="sidebar__top">
      <div id="bm-dock-host" class="inline-dock"></div>
    </div>

    <!-- Contenido de Tow -->
    <div id="tow-container"></div>
  </div>

  <!-- Loaders del chrome (header + dock) -->
  <script defer src="https://beteranomotors.github.io/chrome/components/header/header-loader.js"
          data-target="#bm-header-host"></script>
  <script defer src="https://beteranomotors.github.io/chrome/components/dock/dock-loader.js"
          data-target="#bm-dock-host"></script>

  <!-- Bundle del microfrontend Tow -->
  <script src="./btr-tow.js"></script>
  <script>
    // Montaje robusto: espera a que BTR_Tow esté disponible
    (function mountTow(){
      function tryMount(){
        if (window.BTR_Tow && typeof window.BTR_Tow.mount === 'function'){
          window.BTR_Tow.mount({
            targetId: 'tow-container',
            view: 'quote',
            props: { osrmUrl: 'https://router.project-osrm.org/route/v1', currency: 'CHF' }
          });
          return true;
        }
        return false;
      }
      if (!tryMount()){
        const t = setInterval(() => { if (tryMount()) clearInterval(t); }, 50);
        setTimeout(() => clearInterval(t), 8000);
      }
    })();
  </script>
</body>
</html>
